---
title: "Question 1"
date: "2/26/2020"
output: html_document
---

#```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = TRUE)
#```

## **Question 1: Does typical compensation for Data Science professionals differ among densely populated and sparsely populated areas? (‘Dense’ definition >500 per square mile; ‘sparse’ definition <500 per square mile). **

### *Define density by the amount of people that live in an area per square mile for a given country.*

### *Use ANOVA to test possible differences in multiple groups and Linear Regression to test if there is a linear relationship between compensation and the density of groups. *

### *Test level of power data set allows for our research given the n number of responses.*

```{r, Q1_data, eval =TRUE, echo=FALSE}
# Why did you choose a split of 500 for the density?
library(naniar)
data <- read.csv("C://Users//Matth//OneDrive//Documents//Data Science//DATA 557//557_Final_Project//Data//Data_Science_Density.csv")
high_density <- data[data$Density > 500,]
high_density$CompensationYearUSD[high_density$CompensationYearUSD>500000] <- NA # 4 removed
high_density <- na.omit(high_density, cols= "CompensationYearUSD")
salary <- high_density[high_density$CompensationYearUSD > 30000,]
commision <- high_density[high_density$CompensationYearUSD < 30000,]

low_density <- data[data$Density < 500,]
low_density$CompensationYearUSD[low_density$CompensationYearUSD>500000] <- NA # 11 removed
low_density <- na.omit(low_density, cols= "CompensationYearUSD")
salary2 <- low_density[low_density$CompensationYearUSD > 30000,]
commision2 <- low_density[low_density$CompensationYearUSD < 30000,]
```

# Interesting fact: We have significantly more datapoints for low density locations than high density locations. We initially thought that this would be a problem.
# Also we are not including those people that have shared that they are unemployed in the commision calculations, we found that doing this did not drastically 
# change our data since the people that reported that they make 0$ was very low. It also made sense to only include those people that are working in the calculation.


```{r, facts-chunk, eval =FALSE, echo= FALSE}
# Random data facts (mean, sd, variance) for high
#commision[, 20] <- log(commision[20])
commision <- commision %>% replace_with_na(replace = list(CompensationYearUSD = 0))
commision <- na.omit(commision, cols= "CompensationYearUSD")
high_commision_mean <- mean(commision$CompensationYearUSD)
#high_commision_mean <- exp(commision_mean)
high_commision_sd   <- sd(commision$CompensationYearUSD)
high_commision_var  <- high_commision_sd**2

#salary[, 20] <- log(salary[20])
salary <- salary %>% replace_with_na(replace = list(CompensationYearUSD = 0))
salary <- na.omit(salary, cols= "CompensationYearUSD")
high_salary_mean <- mean(salary$CompensationYearUSD)
#high_salary_mean <- exp(salary_mean)
high_salary_sd   <- sd(salary$CompensationYearUSD)
high_salary_var  <- high_salary_sd**2



# Random data facts (mean, sd, variance) for low
#commision2[, 20] <- log(commision2[20])
commision2 <- commision2 %>% replace_with_na(replace = list(CompensationYearUSD = 0))
commision2 <- na.omit(commision2, cols= "CompensationYearUSD")
low_commision2_mean <- mean(commision2$CompensationYearUSD)
#low_commision2_mean <- exp(commision2_mean)
low_commision2_sd   <- sd(commision2$CompensationYearUSD)
low_commision2_var  <- low_commision2_sd**2


#salary2[, 20] <- log(salary2[20])
salary2 <- salary2 %>% replace_with_na(replace = list(CompensationYearUSD = c(-Inf, Inf)))
salary2 <- na.omit(salary2, cols= "CompensationYearUSD")
low_salary2_mean <- mean(salary2$CompensationYearUSD)
#low_salary2_mean <- exp(salary2_mean)
low_salary2_sd   <- sd(salary2$CompensationYearUSD)
low_salary2_var  <- low_salary2_sd**2
```
# Note that there is a high amount of varaince in the data. This occurs because there are people who are reporting that they make one dollar and people that they are 
# making the upper limit we have capped the data at for commision. Similarly for salary we have people that have reported that they make close to half a million and 
# people that report that they make the minumum we have set of $30,000.
```{r, sample_size, eval=FALSE}
# Sample size estimation for question
delta1 <-  low_salary2_mean - high_salary_mean
delta2 <-   high_commision_mean - low_commision2_mean 
salary_n = ((low_salary2_var + high_salary_var)*  ((qnorm(1- 0.025) + qnorm(.9))**2)   )/(delta1**2)
commision_n = ((low_commision2_var + high_commision_var)*  ((qnorm(1- 0.025) + qnorm(.9))**2)   )/(delta2**2)
```
# Note that we only need a sample size of 138 for commision to achieve a power of .9 and a sample size of 290 for salary to achieve the same power. This is why 
# achieve the power that we have calculated from our experiment.
```{r, power_est, eval=FALSE, echo=FALSE}
# Power estimation for salary
delta1 <-  low_salary2_mean - high_salary_mean
n1 <- dim(salary)[1]
n2 <- dim(salary2)[1]
denom1 <- sqrt(high_salary_var/n1 + low_salary2_var/n2)
Z1 = delta1/denom1
power1 <- pnorm(-1.96 + Z1)


# power estimation for commision
delta <-   low_commision2_mean - high_commision_mean 
n1 <- dim(commision)[1]
n2 <- dim(commision2)[1]
denom <- sqrt(high_commision_var/n1 + low_commision2_var/n2)
Z = delta/denom
power2 <- pnorm(-1.96 + Z)
```

```{r}
# Type 1 error probability 


```


```{r, testing, eval= TRUE, echo=FALSE}
# Actual Anova Test and linear regression of Compensation ~ High_Low_Density for salary
salary <- cbind(high = 1, salary)
salary2 <- cbind(high = 0, salary2)
total_salary <- rbind(salary, salary2)
paste("Anova")
"
summary(aov(total_salary$CompensationYearUSD ~ total_salary$high))
summary(lm(total_salary$CompensationYearUSD ~ total_salary$high))
t.test(total_salary$CompensationYearUSD ~ total_salary$high)
"
# Actual Anova Test and linear regression of Compensation ~ High_Low_Density for commision
commision <- cbind(high = 1, commision)
commision2 <- cbind(high = 0, commision2)
total_commision <- rbind(commision, commision2)
"

summary(aov(total_commision$CompensationYearUSD ~ total_commision$high))
summary(lm(total_commision$CompensationYearUSD ~ total_commision$high))
t.test(total_commision$CompensationYearUSD ~ total_commision$high)
"
# These are commented out so it looks clean on the Paper


```

```{r, Question_1_plots, dependson= "Q1_data", eval=TRUE}
# Interesting plots for salary
plot(total_salary$high, total_salary$CompensationYearUSD)
abline(lm(total_salary$CompensationYearUSD ~ total_salary$high))
#png(filename = "Salary Linear regression.png")
hist(total_salary$CompensationYearUSD)
#png(filename = "Salary histogram.png" )
# Interesting plots for commmision
plot(total_commision$high, total_commision$CompensationYearUSD)
abline(lm(total_commision$CompensationYearUSD ~ total_commision$high))
#png(filename = "Commission Linear regression.png")
hist(total_commision$CompensationYearUSD)
#png(filename = "Commission Histogram.png")

```
# Conclusion from initial statistics, is that we should not use Anova or linear regression because the variances are not the same, and 

# we know that equal variances are a problem no matter how large the sample size thus we should use Welch.
# When looking at the p-value for salary and commision they are 2.592e-12 and 7.519e-11 respectively so there is evidence to reject the null hypothesis
# meaning that density has an effect on compensation for salary and commision.